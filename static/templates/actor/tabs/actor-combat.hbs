<div class="flexrow">
    <div class="actor-property inline">
        <label class="property-label">{{localize "IMPMAL.Initiative"}}</label>
        <div class="property-value">
            <input type="number" value="{{system.combat.initiative}}" disabled>
        </div>
    </div>
    <div class="actor-property inline">
        <label class="property-label">{{localize "IMPMAL.Reflexes"}}</label>
        <div class="property-value">
            <input type="number" value="{{system.skills.reflexes.total}}" disabled>
        </div>
    </div>
    <div class="actor-property inline">
        {{#if (eq actor.type "character")}}
            <label class="property-label">{{localize "IMPMAL.Superiority"}}</label>
            <div class="property-value">
                <input class="superiority-update" type="number" value="{{system.combat.superiority}}" disabled>
            </div>
        {{else if (eq actor.type "npc")}}
            <label class="property-label">{{localize "IMPMAL.Resolve"}}</label>
            <div class="property-value">
                <input type="number" value="{{system.combat.resolve}}" name="system.combat.resolve">
            </div>
        {{/if}}
    </div>
    <div class="actor-property inline">
        <label class="property-label">{{localize "IMPMAL.Size"}}</label>
        <div class="property-value">
            <select name="system.combat.size">
                {{#select system.combat.size}}
                    {{#each (config "sizes")}}
                        <option value="{{@key}}">{{this}}</option>
                    {{/each}}
                {{/select}}
            </select>
        </div>
    </div>
    <div class="actor-property inline">
        <label class="property-label">{{localize "IMPMAL.Speed"}}</label>
        <div class="property-value">
            <input type="text" value="{{system.combat.speed}}" disabled>
        </div>
    </div>
</div>

<section class="list {{#unless items.equipped.melee.length}}inactive{{/unless}}">
    <header class="list-row">
        <div class="list-name">{{localize "IMPMAL.MeleeWeapons"}}</div>
        <div>{{localize "IMPMAL.Specialisation"}}</div>
        <div>{{localize "IMPMAL.Damage"}}</div>
    </header>
    <div class="list-content">
        {{#each items.equipped.melee}}
            <div class="list-item" data-id="{{this.id}}">
                <div class="list-row">
                    <div class="list-name">
                        <img src="{{this.img}}">
                        <a class="roll" data-type="weapon">{{this.name}}</a>
                        {{#if (eq ../actor.type "character")}}
                            <div class="grip">
                                {{#if this.system.equipped.hands.left}}
                                    <span {{#if this.system.equipped.offhand}}class="offhand" {{/if}}
                                        data-hand="left"><i class="fa-solid fa-hand"></i></span>
                                {{/if}}
                                {{#if this.system.equipped.hands.right}}
                                    <span {{#if this.system.equipped.offhand}}class="offhand" {{/if}}
                                        data-hand="right"><i class="fa-solid fa-hand"></i></span>
                                {{/if}}
                            </div>
                        {{/if}}
                    </div>
                    <div>{{this.system.specialisation}}</div>
                    <div>{{this.system.damage.value}}</div>
                </div>
                {{#if this.system.traits.list.length}}
                    <div class="weapon-traits">
                        <label>{{localize 'IMPMAL.Traits'}}: </label>
                        <div class="trait-list">
                            {{this.system.traits.displayString}}
                        </div>
                    </div>
                {{/if}}
            </div>
        {{/each}}
    </div>
</section>

<section class="list {{#unless items.equipped.ranged.length}}inactive{{/unless}}">
    <header class="list-row">
        <div class="list-name">{{localize "IMPMAL.RangedWeapons"}}</div>
        <div>{{localize "IMPMAL.Specialisation"}}</div>
        <div>{{localize "IMPMAL.Damage"}}</div>
        <div>{{localize "IMPMAL.Range"}}</div>
        <div>{{localize "IMPMAL.Ammo"}}</div>
    </header>
    <div class="list-content">
        {{#each items.equipped.ranged}}
            <div class="list-item" data-id="{{this.id}}">
                <div class="list-row">
                    <div class="list-name">
                        <img data-item-id="{{this.id}}" src="{{this.img}}">
                        <a class="roll" data-type="weapon">{{this.name}}</a>
                        {{#if (eq ../actor.type "character")}}
                            <div class="grip">
                                {{#if this.system.equipped.hands.left}}
                                    <span {{#if this.system.equipped.offhand}}class="offhand" {{/if}}
                                        data-hand="left"><i class="fa-solid fa-hand"></i></span>
                                {{/if}}
                                {{#if this.system.equipped.hands.right}}
                                    <span {{#if this.system.equipped.offhand}}class="offhand" {{/if}}
                                        data-hand="right"><i class="fa-solid fa-hand"></i></span>
                                {{/if}}
                            </div>
                        {{/if}}
                    </div>
                    <div>{{this.system.specialisation}}</div>
                    <div>{{this.system.damage.value}}</div>
                    <div>{{configLookup "ranges" this.system.range}}</div>
                    <div>
                        <select class="ammo-selector">
                            {{#select this.system.ammo.id}}
                                <option value=""></option>
                                {{#each ../this.items.ammo}}
                                    <option value="{{this.id}}">{{this.name}} ({{this.system.quantity}})</option>
                                {{/each}}
                            {{/select}}
                        </select>
                    </div>
                </div>
                <div class="weapon-traits">
                    <div class="mag">
                        <label>{{localize "IMPMAL.Mag"}}:</label>
                        <div class="values">
                            <div class="current">{{this.system.mag.current}}</div>
                            <div>/</div>
                            <div class="value">{{this.system.mag.value}}</div>
                        </div>
                        {{#if (lt this.system.mag.current this.system.mag.value)}}
                            <a class="reload">Reload</a>
                        {{/if}}
                    </div>
                    {{#if this.system.traits.list.length}}
                        <label>{{localize 'IMPMAL.Traits'}}: </label>
                        <div class="trait-list">
                            {{this.system.traits.displayString}}
                        </div>
                    {{/if}}
                </div>
            </div>
        {{/each}}
    </div>
</section>

<section class="list {{#unless items.equipped.shield.length}}inactive{{/unless}}">
    <header class="list-row">
        <div class="list-name">{{localize "IMPMAL.Shield"}}</div>
        <div class="shield-traits">{{localize "IMPMAL.Traits"}}</div>
    </header>
    <div class="list-content">
        {{#each items.equipped.shield}}
            <div class="list-item" data-id="{{this.id}}">
                <div class="list-row">
                    <div class="list-name">
                        <img data-item-id="{{this.id}}" src="{{this.img}}">
                        <a>{{this.name}}</a>
                    </div>
                    <div class="shield-traits">
                        <div class="trait-list">
                            {{this.system.traits.displayString}}
                        </div>
                    </div>
                </div>
            </div>
        {{/each}}
    </div>
</section>

<section class="hit-locations">
    {{#each hitLocations}}
        <div class="location">
            <label>{{localize this.label}}</label>
            <label>{{localize "IMPMAL.Armour"}}: {{this.armour}}</label>
            <div class="protection-list">
                {{#each this.items}}
                    <div class="protection-item">
                        <label>{{this.name}} ({{this.system.armour}})</label>
                        <div class="traits">{{this.system.traits.displayString}}</div>
                    </div>
                {{/each}}
                {{#if this.field}}
                    <div class="protection-item">
                        <label>{{this.field.name}} ({{this.field.system.protection}})</label>
                    </div>
                {{/if}}
            </div>
            <div class="range">
                {{this.displayRange}}
            </div>
        </div>
    {{/each}}
</section>

{{#if items.critical.length}}
    <section class="list">
        <header class="list-row">
            <div class="list-name">{{localize "IMPMAL.CriticalWounds"}}</div>
            <div class="list-controls">
                <a class="list-create" data-type="critical"><i class="fa-solid fa-plus"></i></a>
            </div>
        </header>
        <div class="list-content">
            {{#each items.critical}}
                <div class="list-item" data-id="{{this.id}}" data-collection="items">
                    <div class="list-row">
                        <div class="list-name">
                            <img src="{{this.img}}">
                            <a>{{this.name}}</a>
                        </div>
                        <div class="list-controls">
                            <a class="list-edit"><i class="fa-solid fa-edit"></i></a>
                            <a class="list-post"><i class="fa-solid fa-comment"></i></a>
                            <a class="list-delete"><i class="fa-solid fa-trash"></i></a>
                        </div>
                    </div>
                    <div class="summary">

                    </div>
                </div>
            {{/each}}
        </div>
    </section>
{{/if}}
{{#if items.injury.length}}
    <section class="list">
        <header class="list-row">
            <div class="list-name">{{localize "IMPMAL.Injury"}}</div>
            <div class="list-controls">
                <a class="list-create" data-type="injury"><i class="fa-solid fa-plus"></i></a>
            </div>
        </header>
        <div class="list-content">
            {{#each items.injury}}
                <div class="list-item" data-id="{{this.id}}" data-collection="items">
                    <div class="list-row">
                        <div class="list-name">
                            <img src="{{this.img}}">
                            <a>{{this.name}}</a>
                        </div>
                        <div class="list-controls">
                            <a class="list-edit"><i class="fa-solid fa-edit"></i></a>
                            <a class="list-post"><i class="fa-solid fa-comment"></i></a>
                            <a class="list-delete"><i class="fa-solid fa-trash"></i></a>
                        </div>
                    </div>
                    <div class="summary">

                    </div>
                </div>
            {{/each}}
        </div>
    </section>
{{/if}}